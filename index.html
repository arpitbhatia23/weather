<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>weather forcasting</title>
   <link rel="stylesheet" href="style.css">
   <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel="stylesheet">
   <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  </head>
  <body> 
    <div class="background">


     <div class ="container">
      <div class="weather-forcasting">
          <div class="date"></div>

      </div>

        <div id="location"> </div>
       <div class ="search-box">
           <i class="bx bxs-map"></i>
          <input type ="text" placeholder="enter your location">
          <button class="bx bx-search" ></button>
        </div>
        <div class="city"></div>

        <div class="weather-box">
          <div class="info-weather">

          <p class="temperature"> <span> celcius</span></p>
          <p class="description">broken  cloud</p>


           </div>
          <div class="box">
            <div class="weather">
          
            <img src="images/cloud.png" alt="">

          </div>
        </div>

       </div>
       <div class="weather-details-container">
    
        <div class="weather-details">
       <div class="humidity">
        <i class="bx bx-water"></i>
        <div class="text">
        <div class="info-humidity">
          <span>0%</span >
          </div>
                <p>humidity</p>


       </div>
       </div>
         <div class="wind">
       <i class="bx bx-wind"></i>
       <div class="text"></div>
       <div class="info-wind">
       <span>0km/hr</span>
    
       </div>
    
       <p> wind speed</p>
       
        </div>

        <div class="pressure">
       <i class="bx bx-tachometer"></i>
       <div class="text"></div>
       <div class="info-pressure">
       <span>0</span>
    
       </div>
    
       <p>pressure</p>
       
        </div>
        </div>
       </div>

       <div class="not-found">
       <div class="box">
        <img src="images/404.png">
        <p>Oops location not found!</p>
       
       </div>
  
    </div> 
     </div>
     

     <div class="forecast">
      <div class="daily-forecast">5-days-forecast</div>
       
      <div class="weekly-forecast">
<ul id="weeklylist"></ul>
</div>
</div>



<div class="hourly-forecast">
  <div class="hourly-forecast1">24-hours-forecast</div>
  <div class="scroll">
 <ul class="hourly-list"></ul>
  </div>
</div>
<div class="map-container">
  <div id="map">

  </div>
</div>


     <div class="inner-container">

    <div class="sunrise"> 
      <span class="icon" id="sunrise-icon">üåÖ</span>
    </div>
    
    <div class="sunset">
      <span class="icon" id="sunset-icon">üåá</span>
      
    </div>
    <div class="sea-level">
      <span class="icon" id="sea-level-icon">üåä</span>
    </div>
    <div class="ground-level">
      <span class="icon" id="ground-level-icon">‚õ∞Ô∏è</span>
    </div>
    <div class="air-purity"></div>
    </div>
   
  
  </div>
    

 
    <audio id="bg-audio" autoplay loop></audio>
    
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="scrpit.js"></script>
    <script src="https://unpkg.com/leaflet-openweathermap/leaflet-openweathermap.js"></script>

   <script >
async function getCityWeather(city, apiKey) {
    // Your implementation
  }

  function handleNotFound() {
    // Your implementation
  }

document.addEventListener('DOMContentLoaded', function () {
    const markers = [];
    const container = document.querySelector('.container');
    const search = document.querySelector('.search-box button');
    const APIKEY = 'e38b8adced5269e5111dc584c110097a';
    const map = L.map('map').setView([0, 0], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    function showLoadingSpinner() {
        loadingSpinner.style.display = 'block';
    }

    function hideLoadingSpinner() {
        loadingSpinner.style.display = 'none';
    }

    function showMapLoadingState() {
        // Implement logic to show a loading state for the map
    }

    function hideMapLoadingState() {
        // Implement logic to hide the loading state for the map
    }
    async function getWeatherData(city) {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${APIKEY}`);
        const data = await response.json();
        return data;
    }

   


    // Function to add a marker with weather information to the map
    async function addWeatherMarker(city) {
      console.log('adding maker for city',city)
        // Remove previous markers
        markers.forEach(marker => map.removeLayer(marker));
        markers.length = 0;
        try {
        const weatherData = await getWeatherData(city);
        if (!weatherData || !weatherData.coord || !weatherData.weather || !weatherData.main) {
            console.error('Invalid weather data for city:', city);
            return;
        }

        const { coord, weather, main } = weatherData;
        const { lat, lon } = coord;
        const { description, icon } = weather[0];
        const temperature = main.temp;
        const humidity = main.humidity;

        const marker = L.marker([lat, lon]).addTo(map);
        marker.bindPopup(`<b>${city}</b><br>${description}<br>${temperature}¬∞C<br>
        Humidity: ${humidity}%<br>
               <img src="http://openweathermap.org/img/w/${icon}.png" alt="Weather Icon">`);

        // Store the marker in the markers array
        markers.push(marker);

        map.setView([lat, lon], 9);
    } catch (error) {
        console.error('Error fetching weather data:', error);
        // Handle the error, e.g., display an error message to the user
    }
  }
  function addUserLocationMarker() {
        navigator.geolocation.getCurrentPosition(function (position) {
            const userLocation = [position.coords.latitude, position.coords.longitude];

            // Remove previous markers
            markers.forEach(marker => map.removeLayer(marker));
            markers.length = 0;

            const userMarker = L.marker(userLocation).addTo(map);
            userMarker.bindPopup('Your Location').openPopup();
        });
      } addUserLocationMarker();
  
  async function handleWeatherData(cityWeather) {
        // Implement your logic to handle weather data
        // ...

        // Example: Call addWeatherMarker
        addWeatherMarker(cityWeather.name);
    }
    search.addEventListener('click', async () => {
        const cityInput = document.querySelector('.search-box input').value;

        if (cityInput === '') return;

        try {
            const cityWeather = await getWeatherData(cityInput);
            console.log('Weather data:', cityWeather);
            handleWeatherData(cityWeather);
            addWeatherMarker(cityInput)
        } catch (error) {
            console.error('Error fetching data:', error);
            // Handle the error, e.g., display an error message to the user
        }
    });
    search.addEventListener('click', async () => {
        const cityInput = document.querySelector('.search-box input').value;

        if (cityInput === '') return;

        showLoadingSpinner();

        try {
            const cityWeather = await getWeatherData(cityInput);
            console.log('Weather data:', cityWeather);
            handleWeatherData(cityWeather);
            addWeatherMarker(cityInput);
        } catch (error) {
            handleWeatherError(error);
        } finally {
            hideLoadingSpinner();
        }
    });

});

    </script>
 
</body>

</html>